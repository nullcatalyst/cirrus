load("@bazel_skylib//rules:copy_file.bzl", "copy_file")

copy_file(
    name = "config",
    src = "@//third_party/wabt:config.h",
    out = "include/wabt/config.h",
    visibility = [
        "//visibility:public",
    ],
)

cc_library(
    name = "wabt",
    srcs = [
        "src/apply-names.cc",
        "src/binary.cc",
        "src/binary-reader.cc",
        "src/binary-reader-ir.cc",
        "src/binary-reader-logging.cc",
        "src/binary-writer.cc",
        "src/binary-writer-spec.cc",
        "src/binding-hash.cc",
        "src/c-writer.cc",
        "src/color.cc",
        "src/common.cc",
        "src/config.cc",
        "src/decompiler.cc",
        "src/error-formatter.cc",
        "src/expr-visitor.cc",
        "src/feature.cc",
        "src/filenames.cc",
        "src/generate-names.cc",
        "src/ir.cc",
        "src/ir-util.cc",
        "src/leb128.cc",
        "src/lexer-source.cc",
        "src/lexer-source-line-finder.cc",
        "src/literal.cc",
        "src/opcode.cc",
        "src/opcode-code-table.c",
        "src/option-parser.cc",
        "src/resolve-names.cc",
        "src/sha256.cc",
        "src/shared-validator.cc",
        "src/stream.cc",
        "src/token.cc",
        "src/tracing.cc",
        "src/type-checker.cc",
        "src/utf8.cc",
        "src/validator.cc",
        "src/wast-lexer.cc",
        "src/wast-parser.cc",
        "src/wat-writer.cc",
    ],
    hdrs = [
        "include/wabt/apply-names.h",
        "include/wabt/base-types.h",
        "include/wabt/binary.h",
        "include/wabt/binary-reader.h",
        "include/wabt/binary-reader-ir.h",
        "include/wabt/binary-reader-logging.h",
        "include/wabt/binary-reader-nop.h",
        "include/wabt/binary-writer.h",
        "include/wabt/binary-writer-spec.h",
        "include/wabt/binding-hash.h",
        "include/wabt/c-writer.h",
        "include/wabt/cast.h",
        "include/wabt/color.h",
        "include/wabt/common.h",
        "include/wabt/decompiler.h",
        "include/wabt/decompiler-ast.h",
        "include/wabt/decompiler-ls.h",
        "include/wabt/decompiler-naming.h",
        "include/wabt/error.h",
        "include/wabt/error-formatter.h",
        "include/wabt/expr-visitor.h",
        "include/wabt/feature.h",
        "include/wabt/filenames.h",
        "include/wabt/generate-names.h",
        "include/wabt/intrusive-list.h",
        "include/wabt/ir.h",
        "include/wabt/ir-util.h",
        "include/wabt/leb128.h",
        "include/wabt/lexer-source.h",
        "include/wabt/lexer-source-line-finder.h",
        "include/wabt/literal.h",
        "include/wabt/opcode.h",
        "include/wabt/opcode-code-table.h",
        "include/wabt/option-parser.h",
        "include/wabt/range.h",
        "include/wabt/resolve-names.h",
        "include/wabt/result.h",
        "include/wabt/sha256.h",
        "include/wabt/shared-validator.h",
        "include/wabt/stream.h",
        "include/wabt/string-format.h",
        "include/wabt/string-util.h",
        "include/wabt/token.h",
        "include/wabt/tracing.h",
        "include/wabt/type.h",
        "include/wabt/type-checker.h",
        "include/wabt/utf8.h",
        "include/wabt/validator.h",
        "include/wabt/wast-lexer.h",
        "include/wabt/wast-parser.h",
        "include/wabt/wat-writer.h",
        ":config",
    ],
    includes = [
        "include",
    ],
    textual_hdrs = [
        "include/wabt/feature.def",
        "include/wabt/opcode.def",
        "include/wabt/token.def",
        "src/prebuilt/lexer-keywords.cc",
    ],
    visibility = [
        "//visibility:public",
    ],
    deps = [
        "@//third_party/picosha2",
    ],
)

cc_library(
    name = "wabt_interp",
    srcs = [
        "src/interp/binary-reader-interp.cc",
        "src/interp/interp.cc",
        "src/interp/interp-util.cc",
        "src/interp/istream.cc",
    ],
    hdrs = [
        "include/wabt/interp/binary-reader-interp.h",
        "include/wabt/interp/interp.h",
        "include/wabt/interp/interp-inl.h",
        "include/wabt/interp/interp-math.h",
        "include/wabt/interp/interp-util.h",
        "include/wabt/interp/istream.h",
    ],
    includes = [
        "include",
    ],
    visibility = [
        "//visibility:public",
    ],
    deps = [
        ":wabt",
    ],
)
