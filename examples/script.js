const e=-1,n=1,t=2,o=3,a="color:#32a852;font-weight:bold;",r="color:#4287f5;font-weight:bold;",c="color:#eb4034;font-weight:bold;";async function s(s,d,m,u){const p=await async function(e,n){let t;const o=await WebAssembly.instantiateStreaming(fetch(e),{console:{log:(e,n)=>{console.log(l(t,e,n))},error:(e,n)=>{console.error(l(t,e,n))}},math:Math,time:{now_perf:()=>performance.now(),now_unix:()=>Date.now()},env:{callback:(e,o,a)=>{n?n(e,o,a):console.log(l(t,o,a))}}});return t=o.instance.exports.memory,o.instance.exports}("rainc.wasm",((f,b,g)=>{switch(f){case n:{const e=l(p.memory,b,g);console.log("%cCompiled LLVM IR:",r),console.log(e),s(e);break}case t:{const e=i(p.memory,b,g),n=new Uint8Array(e.byteLength);n.set(e),console.log("%cLinked WebAssembly binary:",r,n),d(n);break}case o:{const e=l(p.memory,b,g);console.log("%cCompiled WAT:",r),console.log(e),m(e),console.log("%cSuccess!",a);break}case e:{const e=l(p.memory,b,g);console.error("%cError:",c),console.error(e),u(e);break}}}));return p.init(),function(e,n){monaco.editor.removeAllMarkers("compilation"),console.log("%cCompiling source code:",r),console.log(e);const t=(new TextEncoder).encode(e),o=t.length,a=p.malloc(o+0),c=new Uint8Array(p.memory.buffer,a,o);c.set(new Uint8Array(t));for(let e=o;e<o+0;++e)c[e]=0;p.compile(a,a+o,n),p.free(a)}}function i(e,n,t){return new Uint8Array(e.buffer,n,t-n)}function l(e,n,t){return new TextDecoder("utf8").decode(i(e,n,t))}function d(e,n,t,o){e.languages.register({id:n}),e.languages.setMonarchTokensProvider(n,t),e.languages.setLanguageConfiguration(n,o)}async function m(){return require.config({paths:{vs:"https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.47.0/min/vs"}}),new Promise(((e,n)=>{require(["vs/editor/editor.main"],(async()=>{!function(e){d(e,"rain",{tokenizer:{root:[[/\b(await|break|continue|else|for|if|loop|return|while)\b/,"keyword"],[/\b(export|extern|fn|import|interface|let|struct|var|self)\b/,"keyword"],[/\/\/.*$/,"comment"],[/"(?:[^"\\]|\\.)*"/,"string"],[/\d+/,"number"],[/\d+.\d+/,"number"],[/[A-Za-z_][0-9A-Za-z_]*/,"identifier"],[/\s+/,"whitespace"]]}},{comments:{lineComment:"//"},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"[",close:"]"},{open:"{",close:"}"},{open:"(",close:")"},{open:"'",close:"'",notIn:["string","comment"]},{open:'"',close:'"',notIn:["string"]}],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}]})}(monaco),function(e){d(e,"llvm-ir",{types:["void","half","float","double","x86_fp80","fp128","ppc_fp128","label","metadata","x86_mmx","type","label","opaque","token"],statements:["add","addrspacecast","alloca","and","arcp","ashr","atomicrmw","bitcast","br","catchpad","catchswitch","catchret","call","cleanuppad","cleanupret","cmpxchg","eq","exact","extractelement","extractvalue","fadd","fast","fcmp","fdiv","fence","fmul","fpext","fptosi","fptoui","fptrunc","free","frem","fsub","getelementptr","icmp","inbounds","indirectbr","insertelement","insertvalue","inttoptr","invoke","landingpad","load","lshr","malloc","max","min","mul","nand","ne","ninf","nnan","nsw","nsz","nuw","oeq","oge","ogt","ole","olt","one","or","ord","phi","ptrtoint","resume","ret","sdiv","select","sext","sge","sgt","shl","shufflevector","sitofp","sle","slt","srem","store","sub","switch","trunc","udiv","ueq","uge","ugt","uitofp","ule","ult","umax","umin","une","uno","unreachable","unwind","urem","va_arg","xchg","xor","zext"],keywords:["acq_rel","acquire","addrspace","alias","align","alignstack","alwaysinline","appending","argmemonly","arm_aapcscc","arm_aapcs_vfpcc","arm_apcscc","asm","atomic","available_externally","blockaddress","builtin","byval","c","catch","caller","cc","ccc","cleanup","coldcc","comdat","common","constant","datalayout","declare","default","define","deplibs","dereferenceable","distinct","dllexport","dllimport","dso_local","dso_preemptable","except","external","externally_initialized","extern_weak","fastcc","filter","from","gc","global","hhvmcc","hhvm_ccc","hidden","initialexec","inlinehint","inreg","inteldialect","intel_ocl_bicc","internal","linkonce","linkonce_odr","localdynamic","localexec","local_unnamed_addr","minsize","module","monotonic","msp430_intrcc","musttail","naked","nest","noalias","nobuiltin","nocapture","noimplicitfloat","noinline","nonlazybind","nonnull","norecurse","noredzone","noreturn","nounwind","optnone","optsize","personality","private","protected","ptx_device","ptx_kernel","readnone","readonly","release","returned","returns_twice","sanitize_address","sanitize_memory","sanitize_thread","section","seq_cst","sideeffect","signext","syncscope","source_filename","speculatable","spir_func","spir_kernel","sret","ssp","sspreq","sspstrong","strictfp","swiftcc","tail","target","thread_local","to","triple","unnamed_addr","unordered","uselistorder","uselistorder_bb","uwtable","volatile","weak","weak_odr","within","writeonly","x86_64_sysvcc","win64cc","x86_fastcallcc","x86_stdcallcc","x86_thiscallcc","zeroext"],escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,tokenizer:{root:[[/[,(){}<>[\]]/,"delimiters"],[/i\d+\**/,"type"],[/[%@!]\d+/,"variable.name"],[/-?\d+\.\d*(e[+-]\d+)?/,"number.float"],[/0[xX][0-9A-Fa-f]+/,"number.hex"],[/-?\d+/,"number"],[/\b(true|false)\b/,"keyword"],[/\b(zeroinitializer|undef|null|none)\b/,"constant"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string"],[/[-a-zA-Z$._][-a-zA-Z$._0-9]*(?:\([^:]+\))?:/,"tag"],[/[%@][-a-zA-Z$._][-a-zA-Z$._0-9]*/,"variable.name"],[/![-a-zA-Z$._][-a-zA-Z$._0-9]*(?=\s*)$/,"identifier"],[/![-a-zA-Z$._][-a-zA-Z$._0-9]*(?=\s*[=!])/,"identifier"],[/![A-Za-z]+(?=\s*\()/,"type"],[/\bDW_TAG_[a-z_]+\b/,"constant"],[/\bDW_ATE_[a-zA-Z_]+\b/,"constant"],[/\bDW_OP_[a-zA-Z0-9_]+\b/,"constant"],[/\bDW_LANG_[a-zA-Z0-9_]+\b/,"constant"],[/\bDW_VIRTUALITY_[a-z_]+\b/,"constant"],[/\bDIFlag[A-Za-z]+\b/,"constant"],[/;\s*PR\d*\s*$/,"comment.doc"],[/;\s*REQUIRES:.*$/,"comment.doc"],[/;\s*RUN:.*$/,"comment.doc"],[/;\s*CHECK:.*$/,"comment.doc"],[/;\s*CHECK-(?:NEXT|NOT|DAG|SAME|LABEL):.*$/,"comment.doc"],[/;\s*XFAIL:.*$/,"comment.doc"],[/;.*$/,"comment"],[/[*#=!]/,"operators"],[/[a-z_$][\w$]*/,{cases:{"@statements":"operators","@keywords":"keyword","@types":"type","@default":"identifier"}}],[/[ \t\r\n]+/,"white"]],string:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]]}},{comments:{lineComment:";"},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"[",close:"]"},{open:"{",close:"}"},{open:"(",close:")"},{open:"'",close:"'",notIn:["string","comment"]},{open:'"',close:'"',notIn:["string"]}],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}]})}(monaco),function(e){d(e,"wat",{tokenizer:{root:[[/\;\;.*$/,"comment"],[/\(/,"delimiter.paren.open"],[/\)/,"delimiter.paren.close"],[/\b(module|export|func|memory|global|data|mut|imm)\b/,"keyword"],[/\b(i32|i64|f32|f64)\b/,"number.type"],[/"(?:[^"\\]|\\.)*"/,"string"],[/[a-zA-Z_][\w-]*/,"identifier"],[/\s+/,"white"]]}},{})}(monaco);const n=document.getElementById("source-code").textContent,t=monaco.editor.createModel(n,"rain"),o=monaco.editor.createModel("; Compile to see output here\n","llvm-ir"),a=monaco.editor.createModel(";; Compile to see output here\n","wat"),r=monaco.editor.create(document.getElementById("editor"),{model:t,automaticLayout:!0,wordWrap:"on",theme:window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"vs-dark":"vs"});window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(e=>{r.updateOptions({theme:e.matches?"vs-dark":"vs"})})),e({monaco:monaco,editor:r,rain:t,llvmIr:o,wat:a})}))}))}!async function(){let e=null;const[n,t]=await Promise.all([m(),s((e=>{c.setValue(e)}),(n=>{e=n}),(e=>{i.setValue(e),g("success")}),(e=>{g("error");if(e.indexOf("<unknown>:")>=0){const n=e.split("\n"),[t,a,c,s]=(e=>{const n=e.split(":");return[n[0],Number(n[1]),Number(n[2]),n.slice(3).join(":").trim()]})(n[0]),i=n[2];let l=-1,d=i.length+1;for(let e=0;e<i.length;++e){const n=i[e];-1===l&&" "!==n?l=e:" "!==i[e-1]&&" "===n&&(d=e)}o.editor.setModelMarkers(r,"compilation",[{startLineNumber:a,startColumn:c,endLineNumber:a,endColumn:d,message:`<span color="red">${s}</span>`,severity:o.MarkerSeverity.Error}])}}))]),{monaco:o,editor:a,rain:r,llvmIr:c,wat:i}=n,l=[r,c,i],d=[document.getElementById("rain-tab"),document.getElementById("llvm-ir-tab"),document.getElementById("wat-tab")],u=document.getElementById("compile"),p=document.getElementById("download"),f=document.getElementById("download-size"),b=document.getElementById("optimize");function g(e){u.classList.remove("success"),u.classList.remove("error"),u.classList.add(e),setTimeout((()=>{u.addEventListener("transitionend",(()=>{u.classList.remove("transition")}),{once:!0}),u.classList.add("transition"),requestAnimationFrame((()=>u.classList.remove(e)))}),2e3)}d.forEach(((e,n)=>{e.addEventListener("click",(()=>{d.forEach((e=>e.classList.remove("active"))),e.classList.add("active"),a.setModel(l[n]),a.updateOptions({readOnly:0!==n})}))})),u.addEventListener("click",(()=>{var n;t(r.getValue(),b.checked),null!==e?(p.classList.remove("disabled"),f.innerText=`(${n=e.length,n>1048576?`${(n/1048576).toFixed(2)} MiB`:n>1024?`${(n/1024).toFixed(2)} KiB`:`${n} bytes`})`):p.classList.add("disabled")})),p.addEventListener("click",(()=>{null!==e&&function(e,n,t){const o=new Blob([n],{type:t}),a=URL.createObjectURL(o),r=document.createElement("a");r.href=a,r.download=e,r.click()}("out.wasm",e,"application/wasm")}))}();